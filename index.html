<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Faesh</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; }
    #chat { max-width:600px; margin:auto; padding:20px; }
    .message { margin:10px 0; padding:10px; border-radius:10px; }
    .user { background:#2563eb; text-align:right; }
    .bot { background:#374151; }
    textarea { width:100%; height:60px; margin-top:10px; }
    button { margin-top:5px; padding:8px; }
    input[type=range] { width:100%; }
    label { font-size:12px; opacity:0.8; }
  </style>
</head>

<body>
  <div id="chat"></div>

  <label>Roast Level: <span id="roastValue">1</span></label>
  <input type="range" id="roast" min="0" max="3" value="1" />

  <input type="file" id="imageInput" accept="image/*" />
  <button onclick="sendImage()">Upload Outfit</button>

  <textarea id="input" placeholder="Say something to Faesh..."></textarea>
  <button onclick="sendMessage()">Send</button>

<script>
const chat = document.getElementById("chat");
const input = document.getElementById("input");
const roastSlider = document.getElementById("roast");
const roastValue = document.getElementById("roastValue");

roastSlider.value = localStorage.getItem("roast") || 1;
roastValue.textContent = roastSlider.value;

roastSlider.oninput = () => {
  roastValue.textContent = roastSlider.value;
  localStorage.setItem("roast", roastSlider.value);
};

let messages = JSON.parse(localStorage.getItem("chat") || "[]");
messages.forEach(m => addMessage(m.role, m.content));

function addMessage(role, content) {
  const div = document.createElement("div");
  div.className = `message ${role}`;
  div.textContent = content;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

async function sendMessage() {
  const text = input.value.trim();
  if (!text) return;

  addMessage("user", text);
  messages.push({ role:"user", content:text });
  localStorage.setItem("chat", JSON.stringify(messages));
  input.value = "";

  const res = await fetch("https://faesh.onrender.com/chat", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      messages,
      system: `Roast level is ${roastSlider.value}`
    })
  });

  const data = await res.json();
  addMessage("bot", data.reply);
  messages.push({ role:"bot", content:data.reply });
  localStorage.setItem("chat", JSON.stringify(messages));
}

async function sendImage() {
  const file = document.getElementById("imageInput").files[0];
  if (!file) return alert("Select an image first");

  addMessage("user", "[Uploaded an outfit image]");

  const formData = new FormData();
  formData.append("file", file);

  const res = await fetch("https://faesh.onrender.com/vision", {
    method:"POST",
    body: formData
  });

  const data = await res.json();
  addMessage("bot", data.reply);
}
</script>
</body>
</html>
